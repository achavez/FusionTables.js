/* @license
 *                ____
 *  _____________|    |_
 * |_____________|    |_|
 * | ____  ____  |    | |
 * ||____||    | |____| |
 * || /\/||    |        |
 * ||/   ||____|        |
 * ||____|              |
 *  ————————————————————
 *
 * FusionTables.js v1.1.1
 * https://github.com/achavez/FusionTables.js
 *
 * Copyright (c) 2014 Andrew Chavez
 * Licensed under the MIT license.
 */
!function(root,factory){"function"==typeof define&&define.amd?define(["jquery","underscore"],factory):FusionTables=factory($,_)}(this,function($,_){"use strict";function FusionTables(options){if(this.options=options||{},!this.options.tableId)throw new Error("A Fusion Tables Table ID is required.");if(!this.options.key&&!this.options.proxy)throw new Error("Either an API key or a URL to a proxy that will sign your requests is required.");this.options.columns=this.options.columns||[],this.options.uri=this.options.proxy||"https://www.googleapis.com/",this.options.cache=this.options.cache||!1}return FusionTables.prototype={request:function(endpoint,params,success,error,parser,cache){var req="fusiontables/v1/"+endpoint;params=params||{},this.options.key&&(params.key=this.options.key),this.options.cache!==!0&&cache!==!0||cache===!1||("undefined"!=typeof console&&console.warn&&!this.options.proxy&&console.warn("FusionTables.js: The cache parameter has no effect on direct Fusion Tables API requests."),params.key&&delete params.key,params.cache=!0);var ajax_options={url:this.options.uri+req,contentType:"application/json",data:params};ajax_options.dataType=this.options.proxy?"json":"jsonp",$.ajax(ajax_options).done(function(data){"function"==typeof parser&&(data=parser(data)),success(data)}).fail(function(jqXHR,textStatus,errorThrown){error(errorThrown)})},rowsParser:function(data){return data.rows?_.map(data.rows,function(row){var rowObj={};return _.each(row,function(el,index){"rowid"===data.columns[index]&&(el=parseInt(el,10)),rowObj[data.columns[index]]=el}),rowObj}):null},rowParser:function(data){if(!data.rows)return null;var rowObj={};return _.each(data.rows[0],function(el,index){"rowid"===data.columns[index]&&(el=parseInt(el,10)),rowObj[data.columns[index]]=el}),rowObj},columnParser:function(data){return _.pluck(data.items,"name")},sqlSelect:function(cols){return cols=cols||this.options.columns,cols===["*"]||_.contains(cols,"ROWID")||cols.push("ROWID"),"SELECT "+cols.join(", ")+" FROM "+this.options.tableId},sqlWhere:function(column,value,operator){if(!column||"undefined"==typeof value)throw new Error("The column and value properties are required in the where object.");return operator=operator||"=","WHERE "+column+" "+operator+" "+value},sqlLimit:function(limit){return"LIMIT "+limit},sqlQuery:function(where,limit,cols){var query=[this.sqlSelect(cols)];where&&query.push(this.sqlWhere(where.column,where.value,where.operator)),limit&&query.push(this.sqlLimit(limit));var sql=query.join(" "),params={sql:sql,typed:!0,hdrs:!1};return params},row:function(success,error,where,options){if("undefined"==typeof where)throw new Error("The where clause is required when calling FusionTables.row");var opts=options||{},parser=opts.parser||this.rowParser,params=this.sqlQuery(where,1,opts.columns);this.request("query",params,success,error,parser,opts.cache)},rows:function(success,error,where,options){var opts=options||{},parser=opts.parser||this.rowsParser,params=this.sqlQuery(where,opts.limit,opts.columns);this.request("query",params,success,error,parser,opts.cache)},columns:function(success,error,options){var opts=options||{},parser=opts.parser||this.columnParser,endpoint="tables/"+this.opts.tableId+"/columns";this.request(endpoint,null,success,error,parser,opts.cache)},query:function(success,error,sql,options){var opts=options||{},parser=opts.parser||this.rowsParser,params={sql:sql,typed:!0,hdrs:!1};this.request("query",params,success,error,parser,opts.cache)}},FusionTables});
//# sourceMappingURL=fusiontables.min.map