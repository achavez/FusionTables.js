/* @license
 *                ____
 *  _____________|    |_
 * |_____________|    |_|
 * | ____  ____  |    | |
 * ||____||    | |____| |
 * || /\/||    |        |
 * ||/   ||____|        |
 * ||____|              |
 *  ————————————————————
 *
 * FusionTables.js v1.0.0
 * https://github.com/achavez/FusionTables.js
 *
 * Copyright (c) 2014 Andrew Chavez
 * Licensed under the MIT license.
 */
function FusionTables(options){if(this.options=options||{},!this.options.key||!this.options.tableId)throw new Error("A Fusion Tables Table ID and API key are required.");this.options.columns=this.options.columns||[],this.options.uri=this.options.uri||"https://www.googleapis.com/fusiontables/v1/"}FusionTables.prototype={request:function(req,success,error,parser){$.ajax({url:this.options.uri+req,dataType:"jsonp"}).done(function(data){"function"==typeof parser&&(data=parser(data)),success(data)}).fail(function(jqXHR,textStatus,errorThrown){error(errorThrown)})},rowsParser:function(data){return _.map(data.rows,function(row){var rowObj={};return _.each(row,function(el,index){"rowid"!=data.columns[index]?rowObj[data.columns[index]]=el:rowObj.id=parseInt(el,10)}),rowObj})},rowParser:function(data){var rowObj={};return _.each(data.rows[0],function(el,index){"rowid"==data.columns[index]&&(el=parseInt(el,10)),rowObj[data.columns[index]]=el}),rowObj},columnParser:function(data){return _.pluck(data.items,"name")},sqlSelect:function(cols){return cols=cols||this.options.columns,cols==["*"]||_.contains(cols,"ROWID")||cols.push("ROWID"),"SELECT "+cols.join(", ")+" FROM "+this.options.tableId},sqlWhere:function(column,value,operator){if(!column||!value)throw new Error("The column and value properties are required in the where object.");return operator=operator||"=","WHERE "+column+" "+operator+" "+value},sqlLimit:function(limit){return"LIMIT "+limit},sqlQuery:function(where,limit,cols){var query=[this.sqlSelect(cols)];where&&query.push(this.sqlWhere(where.column,where.value,where.operator)),limit&&query.push(this.sqlLimit(limit));var sql=query.join(" ");return"query?sql="+encodeURIComponent(sql)+"&typed=true&hdrs=false&key="+this.options.key},row:function(success,error,where,cols){var query=this.sqlQuery(where,1,cols);this.request(query,success,error,this.rowParser)},rows:function(success,error,where,limit,cols){var query=this.sqlQuery(where,limit,cols);this.request(query,success,error,this.rowsParser)},columns:function(success,error){var req="tables/"+this.options.tableId+"/columns?key="+this.options.key;this.request(req,success,error,this.columnParser)},query:function(success,error,sql,parser){var req="query?sql="+encodeURIComponent(sql)+"&typed=true&hdrs=false&key="+this.options.key;this.request(req,success,error,parser)}};
//# sourceMappingURL=fusiontables.min.map