/* @license
 *                ____
 *  _____________|    |_
 * |_____________|    |_|
 * | ____  ____  |    | |
 * ||____||    | |____| |
 * || /\/||    |        |
 * ||/   ||____|        |
 * ||____|              |
 *  ————————————————————
 *
 * FusionTables.js v1.2.0
 * https://github.com/achavez/FusionTables.js
 *
 * Copyright (c) 2014 Andrew Chavez
 * Licensed under the MIT license.
 */
!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof module&&module.exports?"undefined"==typeof window&&"undefined"==typeof XMLHttpRequest?module.exports=b(require("request")):module.exports=b():a.FusionTables=b()}(this,function(a){"use strict";function b(a){if(this.options=a||{},!this.options.tableId)throw new Error("A Fusion Tables Table ID is required.");if(!this.options.key&&!this.options.proxy)throw new Error("Either an API key or a URL to a proxy that will sign your requests is required.");this.options.columns=this.options.columns||[],this.options.uri=this.options.proxy||"https://www.googleapis.com/",this.options.cache=this.options.cache||!1}return b.prototype._endpoint_url=function(a,b){a=a||"",b=b||{};var c=this.options.uri+"fusiontables/v1/"+a,d=[];for(var e in b)d.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));return d.length>0&&(c+="?"+d.join("&")),c},b.prototype._json_request=function(a,b,c){var d=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var a=JSON.parse(d.responseText);b(a)}else c(new Error(d.statusText))},d.onerror=function(){c(new Error(d.statusText))},d.send()},b.prototype._jsonp_request=function(a,b,c){var d=!1,e=3e3,f="ft_"+Math.round(1000001*Math.random());window[f]=function(a){b(a),window.clearTimeout(g),d=!0,delete window[f]};var g=window.setTimeout(function(){d||c(new Error("jsonp request to "+a+" timed out after "+e+"ms")),delete window[f]},e);a+=-1===a.indexOf("?")?"?":"&",a+="callback="+f;var h=document.createElement("script");h.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(h)},b.prototype._node_request=function(b,c,d){a({url:b,json:!0},function(a,b,e){a?d(a):200!==b.statusCode?d(new Error("FusionTables API responded with an HTTP "+b.statusCode+" error: "+b.statusText)):c(e)})},b.prototype._api_request=function(b,c,d,e,f,g){c=c||{},this.options.key&&(c.key=this.options.key),this.options.cache!==!0&&g!==!0||g===!1||("undefined"!=typeof console&&console.warn&&!this.options.proxy&&console.warn("FusionTables.js: The cache parameter has no effect on direct Fusion Tables API requests."),c.key&&delete c.key,c.cache=!0);var h=this._jsonp_request;this.options.proxy?h=this._json_request:"undefined"!=typeof a&&(h=this._node_request);var i=this._endpoint_url(b,c),j=function(a){if("function"==typeof f)try{a=f(a)}catch(b){e(b)}d(a)};h(i,j,e)},b.prototype.rowsParser=function(a){if(a.hasOwnProperty("kind")&&"fusiontables#sqlresponse"!==a.kind)throw new Error("Expected fusiontables#sqlresponse response. "+a.kind+" returned instead.");return a.rows&&0!==a.rows.length?a.rows.map(function(b){var c={};return b.forEach(function(b,d){"rowid"===a.columns[d]&&(b=parseInt(b,10)),c[a.columns[d]]=b}),c}):null},b.prototype.rowParser=function(a){if(a.hasOwnProperty("kind")&&"fusiontables#sqlresponse"!==a.kind)throw new Error("Expected fusiontables#sqlresponse response. "+a.kind+" returned instead.");if(!a.rows||0===a.rows.length)return null;var b={};return a.rows[0].forEach(function(c,d){"rowid"===a.columns[d]&&(c=parseInt(c,10)),b[a.columns[d]]=c}),b},b.prototype.columnParser=function(a){if(a.hasOwnProperty("kind")&&"fusiontables#columnList"!==a.kind)throw new Error("Expected fusiontables#columnList response. "+a.kind+" returned instead.");return a.items.map(function(a){return a.name})},b.prototype.sqlSelect=function(a){return a=a||this.options.columns,-1===a.indexOf("*")&&-1===a.indexOf("ROWID")&&a.push("ROWID"),"SELECT "+a.join(", ")+" FROM "+this.options.tableId},b.prototype.sqlWhere=function(a,b,c){if("undefined"==typeof a||"undefined"==typeof b)throw new Error("The column and value properties are required in the where object.");return c=c||"=","WHERE "+a+" "+c+" "+b},b.prototype.sqlLimit=function(a){if(isNaN(a))throw new TypeError("The limit parameter is required when calling .sqlLimit()");return"LIMIT "+a},b.prototype.sqlQuery=function(a,b,c){var d=[this.sqlSelect(c)];a&&d.push(this.sqlWhere(a.column,a.value,a.operator)),b&&d.push(this.sqlLimit(b));var e=d.join(" "),f={sql:e,typed:!0,hdrs:!1};return f},b.prototype.row=function(a,b,c,d){if("undefined"==typeof c)throw new Error("The where clause is required when calling FusionTables.row");var e=d||{},f=e.parser||this.rowParser,g=this.sqlQuery(c,1,e.columns);this._api_request("query",g,a,b,f,e.cache)},b.prototype.rows=function(a,b,c,d){var e=d||{},f=e.parser||this.rowsParser,g=this.sqlQuery(c,e.limit,e.columns);this._api_request("query",g,a,b,f,e.cache)},b.prototype.columns=function(a,b,c){var d=c||{},e=d.parser||this.columnParser,f="tables/"+this.options.tableId+"/columns";this._api_request(f,null,a,b,e,d.cache)},b.prototype.query=function(a,b,c,d){var e=d||{},f=e.parser||this.rowsParser,g={sql:c,typed:!0,hdrs:!1};this._api_request("query",g,a,b,f,e.cache)},b});
//# sourceMappingURL=fusiontables.min.map