/* @license
 *                ____
 *  _____________|    |_
 * |_____________|    |_|
 * | ____  ____  |    | |
 * ||____||    | |____| |
 * || /\/||    |        |
 * ||/   ||____|        |
 * ||____|              |
 *  ————————————————————
 *
 * FusionTables.js v1.2.0
 * https://github.com/achavez/FusionTables.js
 *
 * Copyright (c) 2014 Andrew Chavez
 * Licensed under the MIT license.
 */
!function(a,b){"function"==typeof define&&define.amd?define(["underscore"],b):a.FusionTables=b(_)}(this,function(a){"use strict";function b(a){if(this.options=a||{},!this.options.tableId)throw new Error("A Fusion Tables Table ID is required.");if(!this.options.key&&!this.options.proxy)throw new Error("Either an API key or a URL to a proxy that will sign your requests is required.");this.options.columns=this.options.columns||[],this.options.uri=this.options.proxy||"https://www.googleapis.com/",this.options.cache=this.options.cache||!1}return b.prototype._endpoint_url=function(a,b){a=a||"",b=b||{};var c=this.options.uri+"fusiontables/v1/"+a,d=[];for(var e in b)d.push(encodeURIComponent(e)+"="+encodeURIComponent(b[e]));return d.length>0&&(c+="?"+d.join("&")),c},b.prototype._json_request=function(a,b,c){c=c||console.error;var d=new XMLHttpRequest;d.open("GET",a,!0),d.setRequestHeader("Accept","application/json"),d.onload=function(){if(d.status>=200&&d.status<400){var a=JSON.parse(d.responseText);b(a)}else c(new Error(d.statusText))},d.onerror=function(){c(new Error(d.statusText))},d.send()},b.prototype._jsonp_request=function(a,b,c){c=c||console.error;var d=!1,e=3e3,f="ft_"+Math.round(1000001*Math.random());window[f]=function(a){b(a),window.clearTimeout(g),d=!0,delete window[f]};var g=window.setTimeout(function(){d||c(new Error("jsonp request to "+a+" timed out after "+e+"ms")),delete window[f]},e);a+=-1===a.indexOf("?")?"?":"&",a+="callback="+f;var h=document.createElement("script");h.setAttribute("src",a),document.getElementsByTagName("head")[0].appendChild(h)},b.prototype._api_request=function(a,b,c,d,e,f){b=b||{},this.options.key&&(b.key=this.options.key),this.options.cache!==!0&&f!==!0||f===!1||("undefined"!=typeof console&&console.warn&&!this.options.proxy&&console.warn("FusionTables.js: The cache parameter has no effect on direct Fusion Tables API requests."),b.key&&delete b.key,b.cache=!0);var g=this.options.proxy?this._json_request:this._jsonp_request,h=this._endpoint_url(a,b),i=function(a){"function"==typeof e&&(a=e(a)),c(a)};g(h,i,d)},b.prototype.rowsParser=function(b){return b.rows?a.map(b.rows,function(c){var d={};return a.each(c,function(a,c){"rowid"===b.columns[c]&&(a=parseInt(a,10)),d[b.columns[c]]=a}),d}):null},b.prototype.rowParser=function(b){if(!b.rows)return null;var c={};return a.each(b.rows[0],function(a,d){"rowid"===b.columns[d]&&(a=parseInt(a,10)),c[b.columns[d]]=a}),c},b.prototype.columnParser=function(b){return a.pluck(b.items,"name")},b.prototype.sqlSelect=function(b){return b=b||this.options.columns,b===["*"]||a.contains(b,"ROWID")||b.push("ROWID"),"SELECT "+b.join(", ")+" FROM "+this.options.tableId},b.prototype.sqlWhere=function(a,b,c){if(!a||"undefined"==typeof b)throw new Error("The column and value properties are required in the where object.");return c=c||"=","WHERE "+a+" "+c+" "+b},b.prototype.sqlLimit=function(a){return"LIMIT "+a},b.prototype.sqlQuery=function(a,b,c){var d=[this.sqlSelect(c)];a&&d.push(this.sqlWhere(a.column,a.value,a.operator)),b&&d.push(this.sqlLimit(b));var e=d.join(" "),f={sql:e,typed:!0,hdrs:!1};return f},b.prototype.row=function(a,b,c,d){if("undefined"==typeof c)throw new Error("The where clause is required when calling FusionTables.row");var e=d||{},f=e.parser||this.rowParser,g=this.sqlQuery(c,1,e.columns);this._api_request("query",g,a,b,f,e.cache)},b.prototype.rows=function(a,b,c,d){var e=d||{},f=e.parser||this.rowsParser,g=this.sqlQuery(c,e.limit,e.columns);this._api_request("query",g,a,b,f,e.cache)},b.prototype.columns=function(a,b,c){var d=c||{},e=d.parser||this.columnParser,f="tables/"+this.options.tableId+"/columns";this._api_request(f,null,a,b,e,d.cache)},b.prototype.query=function(a,b,c,d){var e=d||{},f=e.parser||this.rowsParser,g={sql:c,typed:!0,hdrs:!1};this._api_request("query",g,a,b,f,e.cache)},b});
//# sourceMappingURL=fusiontables.min.map